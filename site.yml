---
- name: Gather facts
  hosts: all
  any_errors_fatal: True
  tasks:
    - name: Gather facts for ansible_env
      setup:
        fact_path: ansible_env

- name: Provision Droplet
  hosts: localhost
  any_errors_fatal: True
  vars_files:
    - group_vars/do_droplet_vars
    - group_vars/vault_vars
  tasks:
    - name: Provision Droplet
      community.digitalocean.digital_ocean_droplet:
        state: present
        name: "{{ do_droplet_name }}"
        oauth_token: "{{ do_api_key }}"
        size: "{{ do_droplet_size }}"
        region: "{{ do_region }}"
        image: "{{ do_image_name }}"
        monitoring: yes
        backups: yes
        wait_timeout: 500
        ssh_keys: "{{ do_ssh_key_fingerprints }}"
      register: my_droplet

    - debug:
        msg: "ID is {{ my_droplet.data.droplet.id }}, IP is {{ my_droplet.data.ip_address }}"
    